import os
import requests
from cve_monitor.logging import logger
from cve_monitor.config import TELEGRAM_TOKEN, TELEGRAM_GROUP_ID


# Ham kiem tra va tao moi file neu khong ton tai
def try_create_file(file_path):
    try:
        if not os.path.exists(file_path):
            with open(file_path, "w"):
                pass
    except Exception as ex:
        logger.warning(str(ex))


# Ham send message to Telegram
def send_telegram(msg):
    telegram_url = "https://api.telegram.org/bot{}/sendMessage".format(TELEGRAM_TOKEN)
    requests.post(telegram_url, json={'text': msg, 'chat_id': TELEGRAM_GROUP_ID})


# Ham update tw post_id vao file
def update_twitter_pid(file_path, tw_id):
    try:
        try_create_file(file_path)
        with open(file_path, "a") as fap:
            fap.write(f"{tw_id}\n")
    except Exception as ex:
        logger.warning(str(ex))


# Ham lay ra cac tw post_id dang co
def get_all_twitter_pid(file_path):
    try:
        try_create_file(file_path)
        lines = []
        with open(file_path) as f:
            lines = f.readlines()
    except Exception as ex:
        logger.warning(str(ex))
    return list(set(lines))
